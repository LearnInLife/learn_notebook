# 异常、模块

[TOC]



## 异常

### 捕获异常 try...except...

```python
try:
    语句 
except 异常:
    语句 #如果在try部分引发了异常，执行except下的语句
```

- 把可能出现问题的代码，放在try中
- 把处理异常的代码，放在except中

```python
try:
    print('try...')
    r = 10 / 0
    print('result:', r)
except Exception:
    print('except')
```



### except捕获多个异常

```python
try:
    语句 
except 异常1:
    语句 #如果在try部分引发了异常，执行except下的语句
except 异常2:
    语句 #如果在try部分引发了异常，执行except下的语句
```

一个try可以包含多个except子句，但子句中只有一个分支会被处理。

捕获多个异常，也可以使用一个元组的方式列出，如下示例：

```python
try:
    print('-----test--1---')
    open('123.txt','r') # 如果123.txt文件不存在，那么会产生 IOError 异常
    print('-----test--2---')
    print(num)# 如果num变量没有定义，那么会产生 NameError 异常

except (IOError,NameError): 
    #如果想通过一次except捕获到多个异常可以用一个元组的方式
    print('errorMsg')
```



### 获取异常的信息描述

如果希望在except字句中访问异常对象本身，可以使用 as e的形式。

```python
try:
    print('-----test--1---')
    print(num)# 如果num变量没有定义，那么会产生 NameError 异常
    print('-----test--2---')

except (IOError,NameError) as e: 
    #如果想通过一次except捕获到多个异常可以用一个元组的方式
    print(e)
    
 ####################
----test-1----
name 'num' is not defined
```



### 捕获所有异常

```python
try:
    # 如果num变量没有定义，那么会产生 NameError 异常
    print(num)
except: 
    print('error')
    
 ##或者
try:
    # 如果num变量没有定义，那么会产生 NameError 异常
    print(num)
except Exception as e: 
    print(e)
```



### 异常中的else

在if中，它的作用是当条件不满足时执行的实行；同样在try...except...中也是如此，即如果没有捕获到异常，那么就执行else中的事情 

```python
try:
    num = 100
    print(num) 
except NameError as errorMsg:
    print('产生错误了:%s'%errorMsg)
else:
    print('没有捕获到异常')
    
##################
100
'没有捕获到异常'
```



### try...finally...

try...finally...语句是无论发生异常与否，最终都会执行finally的字句代码

```python
try:
    num = 100
    print(num) 
except NameError as errorMsg:
    print('产生错误了:%s'%errorMsg)
else:
    print('没有捕获到异常')
finally:
    print('始终都要执行')
    
##############
100
'没有捕获到异常'
'始终都要执行'
```



### 抛出异常

在python代码中，可以主动用`raise`语句抛出一个异常

```python
def foo(s):
    n = int(s)
    if n==0:
        raise ValueError('invalid value: %s' % s)
    return 10 / n

def bar():
    try:
        foo('0')
    except ValueError as e:
        print('ValueError!')
        raise
```

在`bar()`函数中的except字句中，再次通过`raise`语句将错误抛出去了 。这样的好处在于，如果当前函数不知道如何处理该错误，最恰当的方式就是继续往上抛，让顶层调用者去处理 。

`raise`语句如果不带参数，就会把当前错误原样抛出 。



### 自定义异常

在python中，可以通过继承Exception类，创建一个自己的异常类。

```python
class ShortInputException(Exception):
    '''自定义的异常类'''
    pass

def main():
    try:
        s = input('请输入 --> ')
        if len(s) < 3:
            # raise引发一个你定义的异常
            raise ShortInputException(len(s), 3)
    except ShortInputException as result:#x这个变量被绑定到了错误的实例
        print('ShortInputException: 输入的长度是 %d,长度至少应是 %d'% (result.length, result.atleast))
    else:
        print('没有异常发生.')
```





## 模块

